* org-roam-citation-keyword-nodes.el

This package synchronizes keywords found in a bibliography (a bibtex file) with [[https://www.orgroam.com/][org-roam]] nodes (the term /node/ is org-roam jargon for a note, a zettel, a single file in the org-roam database).

For each keyword in the bibliography, an org-roam node is created if it does not already exist. In this node a heading is created that contains references to the entries in the bibliography that has the corresponding keyword assigned. If the node already contains a reference, the reference will not be added again to the dedicated references heading.

** Requirements

- Obviously, [[https://www.orgroam.com/][org-roam]] is needed. I tested with org-roam v2.2.2 and used emacs's built-in sqlite database, which is part of GNU Emacs since v29 (I think).
- To parse the bibliography, the package [[https://github.com/emacs-citar/citar][citar]] is used. I tested with v1.4.0.

** Installation

The package is not available via ELPA / MELPA.

To install the package, you may use [[https://github.com/radian-software/straight.el][straight.el]]. With straight.el, you need to put the following into your config:

#+begin_src emacs-lisp
  (straight-use-package
   '(org-roam-citation-keyword-nodes
     :type git :host github
     :repo "nuthub/org-roam-citation-keyword-nodes"))
#+end_src

Or, if you use straight.el's version of use-package, you can use something like the following to install this package.

#+begin_src emacs-lisp
  (use-package org-roam-citation-keyword-nodes
    :after roam citar
    :straight (org-roam-citation-keyword-nodes
  	     :type git :host github
  	     :repo "nuthub/org-roam-citation-keyword-nodes"))
#+end_src

** Configuration

This is an example, of how you can configure this package. The examples set the default values, which is not necessary, since the values are already set by default.

#+begin_src emacs-lisp
  (use-package org-roam-citation-keyword-nodes
    :after roam citar
    :straight (org-roam-citation-keyword-nodes
  	     :type git :host github
  	     :repo "nuthub/org-roam-citation-keyword-nodes")
    :config
    ;; The key (as in key/value) of the bibtex field that contains keywords.
    (setq jf/org-roam-references-keyword-field "keywords")
    ;; The character, the bibtex keyword entries are separated by.
    (setq jf/org-roam-references-keyword-separator ",")
    ;; The key (as in keyboard) of the template to use for new org-roam nodes.
    (setq jf/org-roam-references-capture-template-key "d")
    ;; A fallback template that is used, if the capture template key is nil.
    (setq jf/org-roam-references-capture-fallback-template
     	("d" "default" plain "%?"
  	 :target (file+head "%<%Y%m%d%H%M%S>-${slug}.org"
  			    "#+title: ${title}\n")
  	 :unnarrowed t))
    ;; The org heading that should contain the references added to a keyword node.
    (setq jf/org-roam-references-heading "References")
    ;; The tags/property/todo match expression for searching the reference heading.
    (setq jf/org-roam-references-heading-filter "LEVEL=1"))    
#+end_src

** Usage

1. Make a backup of your org-roam database.
2. Optional: Change your ~org-roam-directory~ for an initial synchronization to an empty directory to preview your results.
3. Optional: Make sure, your org-roam-db is in sync with your file system. Run ~M-x org-roam-db-sync~ to be sure.
4. Run ~M-x jf/org-roam-references-sync-keywords-to-roam-db~.
5. Cross your fingers and wait (took 4 minutes with about 500 citations and 150 distinct keywords).
6. Inspect the results (preferably with [[https://github.com/org-roam/org-roam-ui][org-roam-ui]]) and discover relationships in your literature database that you weren't aware of.

The quality and usefulness of the result depend on the quality of your literature database, of course. It is a good idea to review the keywords (or groups, if you used groups in JabRef or similar) before migrating the nodes and references to your existing org-roam database.

The result may look similar to this one (in ~org-roam-ui~):
[[./images/screenshot-2023-12-11.png]]

The colored dots are org-roam nodes, the grey dots are citations. To create an org-roam node dedicated to a citation to capture additional information on that citation, the package [[https://github.com/emacs-citar/citar-org-roam][citar-org-roam]] is what you want.

** Known issues
- ROAM_REFS property is not added to the nodes. This is used by [[https://github.com/emacs-citar/citar-org-roam][citar-org-roam]] to quickly find all nodes that relate to a citation. To add this functionality, is a one-liner, but I am not sure, if this is what I really want. This could of course be configurable.
- These are one of my first Emacs Lisp steps (except for configuration things). So code quality may be improvable (suggestions welcome).
- ERT test cases are missing.
- Incompatibility with frames-only-mode.
